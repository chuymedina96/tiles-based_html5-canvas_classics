<!DOCTYPE html>
<html lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <title>New game</title>
  </head>
  <body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
  </body>

<script>

var canvas;
var canvasContext;

var ballX = 75;
var ballY = 75;

var ballSpeedX = 5;
var ballSpeedY = 7;

const BRICK_W = 80;
const BRICK_H = 20;
const BRICK_GAP = 2;
const BRICK_COLS = 10;
const BRICK_ROWS = 11;

var brickGrid = new Array(BRICK_COLS * BRICK_ROWS);


const PADDLE_WIDTH = 100;
const PADDLE_THICKNESS = 10;
const PADDLE_DIST_FROM_BOTTOM = 60;

var paddleX = 400;
var paddleY = 100;

var mouseX=0;
var mouseY=0;


function updateMousePos(evt){

  var rect = canvas.getBoundingClientRect();
  var root = document.documentElement;

  mouseX = evt.clientX - rect.left - root.scrollLeft;
  mouseY = evt.clientY - rect.top - root.scrollTop;

  paddleX = mouseX - PADDLE_WIDTH/2;

}


function brickReset(){

  for(var i =0; i < BRICK_COLS * BRICK_ROWS; i++){
    if(Math.random() < 0.5){
       brickGrid[i]= true;
     }else{
       brickGrid[i]= false;
     } //end of else (rand check)
  } // end of for each brick

} // end of brickReset function


window.onload = function(){

  console.log("Loaded");

  canvas = document.getElementById('gameCanvas');
  canvasContext = canvas.getContext('2d');


  var framesPerSecond = 30;
  setInterval(updateAll, 1000/framesPerSecond);

  canvas.addEventListener('mousemove', updateMousePos);

  brickReset()

}


function colorRect(topLeftX, topLeftY, boxWidth,boxHeight, drawColor){

  canvasContext.fillStyle = drawColor;
  canvasContext.fillRect(topLeftX,topLeftY, boxWidth,boxHeight, drawColor);

}


function drawCircle(centerX,centerY, radius, fillColor){

  canvasContext.fillStyle = fillColor;
  canvasContext.beginPath(); //this is more of general routine
  canvasContext.arc(centerX,centerY, radius, 0,Math.PI*2, true); //arc is more for drawing pi chart like things.
  canvasContext.fill(); //this will fill the circle

}


function colorText(showWords, textX,textY, fillColor){

  canvasContext.fillStyle = fillColor;
  canvasContext.fillText(showWords, textX,textY);

}


function drawBricks(){
  //USING THE COLORRECT FUNCTION LOCATED ON LINE 67 TO DRAW THE RECTANGLES FOR THE BRICKS.
  for(var eachRow = 0; eachRow < BRICK_ROWS; eachRow++){

    for(var eachCol = 0; eachCol < BRICK_COLS; eachCol++){

      var arrayIndex =  BRICK_COLS * eachRow + eachCol;

      if(brickGrid[arrayIndex]){
        colorRect(BRICK_W*eachCol, BRICK_H * eachRow, BRICK_W - BRICK_GAP,BRICK_H - BRICK_GAP, 'blue');
      }

    }

  }

}


function drawAll(){

  colorRect(0,0,canvas.width,canvas.height, 'black');
  drawCircle(ballX,ballY, 10, 'red');

  colorRect(paddleX,canvas.height-PADDLE_DIST_FROM_BOTTOM, PADDLE_WIDTH,PADDLE_THICKNESS, 'white');

  drawBricks(); //THIS INVOKES THE DRAWBRICKS FUNCTION ON LINE 93 OF PROGRAM.

  var mouseBrickXCol = Math.floor(mouseX / BRICK_W);
  var mouseBrickYRow = Math.floor(mouseY / BRICK_H);

  colorText(mouseBrickXCol+" , "+mouseBrickYRow, mouseX,mouseY, 'red');

}


function ballReset(){

  ballX = canvas.width/2;
  ballY =  canvas.height/2;

}


function moveAll(){

  ballX += ballSpeedX;
  ballY += ballSpeedY;

  var paddleTopEdgeY    = canvas.height - PADDLE_DIST_FROM_BOTTOM;
  var paddleBottomEdgeY = paddleTopEdgeY + PADDLE_THICKNESS;
  var paddleLeftEdgeX   = paddleX;
  var paddleRightEdgeX  = paddleLeftEdgeX + PADDLE_WIDTH;

  if(ballY > paddleTopEdgeY && //ball is below top of paddle
     ballY < paddleBottomEdgeY && // ball is above paddle
     ballX > paddleLeftEdgeX && // right of the left side of paddle
     ballX < paddleRightEdgeX){ // ball is left of right of paddle
       ballSpeedY *= -1;


      var centerOfPaddleX = paddleX + PADDLE_WIDTH/2;
      var ballDistFromPaddleCenterX = ballX - centerOfPaddleX;
      ballSpeedX = ballDistFromPaddleCenterX * 0.35;
  }

  if(ballY >= canvas.height){
    ballReset();
  }else if(ballY <= 0){
    ballSpeedY *= -1;
  }

  if(ballX >= canvas.width){
    ballSpeedX *= -1;
  }else if(ballX <= 0){
    ballSpeedX *= -1;
  }

  // console.log(ballX);

}


function updateAll(){

  drawAll(); //invokes the drawAll functon that draws canvas and ball etc.
  moveAll(); //invokes the moveAll() function that is responsible for motion.

}


</script>
</html>
